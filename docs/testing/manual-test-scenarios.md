# 手動テストシナリオ（T-014）

## 1. 目的

MVP の主要ユーザーフローを人間の実操作で確認し、受け入れ可否を判定する。

## 2. 実施前提

- `nvm use 20` などで Node v20 系を利用する
- ルートで `npm install`
- `npm run dev:api` と `npm run dev:web` を別ターミナルで起動
- API: `http://localhost:3001`
- Web: `http://localhost:5173`
- テストデータは `docs/testing/data/` 直下の ENEX ファイルを利用する

## 3. テストデータ

| ファイル名      | 目的                               | 備考                                              |
| --------------- | ---------------------------------- | ------------------------------------------------- |
| `small.enex`    | 正常系確認（10 件）                | タグ/タイムスタンプを含む標準データセット         |
| `medium.enex`   | 100 件規模での体感性能・ページング | 長時間操作で検索・ページングのストレスを確認      |
| `warnings.enex` | エンコード警告表示                 | 2 件中 1 件が本文欠落のため API が warning を返す |
| `broken.enex`   | XML 破損のエラー挙動               | パース不能なファイルでエラー UI を確認            |

> 必要に応じて `docs/testing/data/` を配布。別環境で再生成したい場合は Node スクリプトを用意しておくと便利（例: `node scripts/generate-enex-fixtures.mjs` など）。

## 4. シナリオ

### MT-001 正常アップロード（small）

- 手順:
  1. Web を開く
  2. `small.enex` を選択してアップロード
- 期待結果:
  - 処理が完了し、エラー表示が出ない
  - 一覧表示に必要な情報（importId/件数）が確認できる

### MT-002 一覧表示とページング

- 手順:
  1. `small.enex` 取り込み後の一覧を確認
  2. ページングボタンを往復
- 期待結果:
  - タイトル、日時、タグ/抜粋が表示される
  - 件数表示が import 結果と一致する
  - ページングで重複選択やエラーが発生しない

### MT-003 検索と表示件数変更

- 手順:
  1. `small.enex` 取り込み後、既知キーワードで検索
  2. 非一致キーワードで検索
  3. 一覧上部の `Per page` プルダウンで表示件数を 20 / 50 / 100 に切り替える
  4. 表示件数を切り替えた直後に先頭ページ（1 件目）から再表示されることを確認する
- 期待結果:
  - 一致ノートのみ表示される
  - 非一致では 0 件表示となる
  - 表示件数の切り替えに応じて一覧の表示範囲とページング幅が変わる
  - URL を直接編集しなくても UI 操作だけで `limit` を変更できる

### MT-004 ノート詳細とサニタイズ

- 手順:
  1. 一覧から任意ノートを選択
  2. DevTools で HTML を確認し危険なタグ実行がないか確認
- 期待結果:
  - タイトル、日時、タグ、本文、添付情報が表示される
  - 表示崩れや危険な HTML 実行がない

### MT-005 解析エラー（`broken.enex`）

- 手順:
  1. `broken.enex` をアップロード
  2. エラー表示を確認後、`small.enex` など正常ファイルを再アップロード
- 期待結果:
  - API は `code: INVALID_XML` を含む JSON エラーを返し、Web には「ファイル破損の可能性と再エクスポートを促す」文言が表示される
  - エラー表示中でもファイル再選択と再アップロードが可能で、画面が操作不能にならない

### MT-006 警告表示（`warnings.enex`）

- 手順:
  1. `warnings.enex` をアップロード
  2. 結果ダイアログに warning 数が表示されることを確認
- 期待結果:
  - warning バッジが表示される
  - 一部ノートが欠落しても UI は操作可能

### MT-007 体感性能（`medium.enex`）

- 手順:
  1. `medium.enex` をアップロード
  2. 一覧表示、検索、詳細表示を操作
- 期待結果:
  - 著しい遅延やフリーズがない

### MT-008 レスポンシブ表示（390px 想定）

- 手順:
  1. `small.enex` をアップロードし、ノート一覧が表示された状態にする
  2. 開発者ツールで 390x844（iPhone 12 相当）へ切り替える
  3. 検索フォーム（Search/Clear/Per page）を操作し、縦積み表示で崩れないか確認する
  4. 一覧からノートを選択し、詳細パネル（タグ・メタ情報・Resources・Content）を確認する
  5. 画面を上下スクロールし、横スクロールが発生しないことを確認する
- 期待結果:
  - 検索フォームの各コントロールが画面幅内に収まり、ボタンのタップ領域が確保されている
  - ノート一覧と詳細パネルが縦方向に配置され、どちらも横にはみ出さない
  - 長いタイトル/タグ/リソース名を含む場合でも、テキストが折り返されて表示が崩れない
  - 主要操作（検索・クリア・ページング・ノート選択・詳細閲覧）がモバイル幅で継続できる

## 5. 結果記録テンプレート

- 実施日:
- 実施者:
- 対象ブランチ/コミット:

| ID     | 結果 (Pass/Fail) | メモ                                                             |
| ------ | ---------------- | ---------------------------------------------------------------- |
| MT-001 | Pass             |                                                                  |
| MT-002 | Pass             |                                                                  |
| MT-003 | Fail             | limit オプションが動作しない                                     |
| MT-004 | Pass             |                                                                  |
| MT-005 | Fail             |                                                                  |
| MT-006 | Pass             |                                                                  |
| MT-007 | Pass             |                                                                  |
| MT-008 | Pass             | 390px 幅で横スクロールなし、検索フォームと詳細表示の操作性を確認 |

## 6. 判定基準

- 重大不具合（操作不能、表示不能、クラッシュ）が 0 件
- MT-001〜MT-006 はすべて Pass
- MT-007/MT-008 はUX上重大な問題がない

## 7. テスト時メモ

- 検索条件を "Claer" ボタンではなく、入力フォームの右端にある x で消した場合に、検索結果が変わらない不具合
- 初期のスケルトンに含まれていた UI は不要
  - TypeScript REST API + Web UI
  - Hello from TypeScript REST API
  - 最下部のタイムスタンプ
- 上記スケルトンに含まれていた UI にまつわるバックエンドの実装も不要
- 画面のタイムスタンプの表記は ISO フォーマットのままでは無く、人間の読みやすい yyyy-mm-dd hh:mm:ss が望ましい
- 一覧をソートするオプションが欲しい
- 画面上に二つの一覧は不要
  - 下にある 2 ペインの UI のみ残し、そちらに検索機能を付けたい
- スタイルをデザインはなるべくそのまま Tailwind で書き直したい
