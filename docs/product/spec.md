# ENEX Viewer 仕様書

## 1. ユースケース
- UC-001: ユーザーが ENEX をアップロードし、ノート一覧を確認する。
- UC-002: ユーザーがノート詳細を開き、本文とメタデータを閲覧する。
- UC-003: ユーザーが検索語で対象ノートを絞り込む。
- UC-004: ユーザーが解析エラーを確認し、再アップロードする。

## 2. 画面仕様（MVP）
### 2.1 アップロード画面
- 単一 ENEX ファイルを受け付ける。
- 解析中は進行状態を表示する。

### 2.2 ノート一覧画面
- カラム: タイトル、作成日、更新日、タグ数。
- ソート: 更新日降順（デフォルト）。
- 検索ボックス: タイトル/本文/タグ対象。

### 2.3 ノート詳細画面
- 表示項目: タイトル、作成日、更新日、タグ、本文、添付ファイル情報。
- 本文はサニタイズ済み HTML として描画する。

## 3. API 仕様（MVP）
- `POST /api/enex/parse`
  - 入力: multipart/form-data (`file`)
  - 出力: `{ importId, noteCount, warnings[] }`
- `GET /api/imports/:importId/notes`
  - 入力: `q`, `limit`, `offset`（任意）
  - 出力: ノート一覧 + 総件数
- `GET /api/imports/:importId/notes/:noteId`
  - 出力: ノート詳細

## 4. エラーハンドリング仕様
- 400: ファイル形式不正、必須パラメータ不備
- 413: ファイルサイズ超過
- 422: ENEX 解析失敗
- 500: 想定外エラー

エラー形式は以下で統一する。
- `{ code: string, message: string, details?: unknown }`

## 5. データ保持方針（MVP）
- 初期版はインメモリ保持。
- プロセス再起動でデータは消える。
- 将来拡張で SQLite など永続層に切り替え可能な抽象を設計時に確保する。

## 6. 並列実装のための契約・モック方針
- API 実装より先に、`apps/api/openapi.yaml` と本仕様の API 章を固定する。
- Web は固定した契約に対してモックレスポンスで実装・テストを進めてよい。
- 実 API 接続時に、以下の互換性を確認する。
  - HTTP ステータス
  - レスポンス JSON の型
  - エラーフォーマット `{ code, message, details? }`
